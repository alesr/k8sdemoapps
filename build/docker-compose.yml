services:
  prometheus:
    image: prom/prometheus:v2.54.1
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    restart: always
    networks:
      - demoapp-network

  demoapp1:
    image: demoapp1:latest
    build:
      context: ..
      dockerfile: build/Dockerfile
      args:
        APP_NAME: demoapp1
        APP_PATH: cmd/demoapp1
    container_name: demoapp1-container
    restart: always
    ports:
      - "8081:8080"
      - "9001:9000"
    environment:
      - DEMOAPP2_ADDR=http://demoapp2:8080  
      - DEMOAPP3_ADDR=http://demoapp3:8080
    networks:
      - demoapp-network
    command: ./demoapp1 

  demoapp2:
    image: demoapp2:latest
    build:
      context: ..
      dockerfile: build/Dockerfile
      args:
        APP_NAME: demoapp2
        APP_PATH: cmd/demoapp2
    container_name: demoapp2-container
    restart: always
    ports:
      - "8082:8080" 
    networks:
      - demoapp-network
    command: ./demoapp2 

  demoapp3:
    image: demoapp3:latest
    build:
      context: ..
      dockerfile: build/Dockerfile
      args:
        APP_NAME: demoapp3
        APP_PATH: cmd/demoapp3
    container_name: demoapp3-container
    restart: always
    ports:
      - "8083:8080"
    networks:
      - demoapp-network
    command: ./demoapp3 

networks:
  demoapp-network:
